{% extends 'base.html' %}
{% block content %}
<div class="container">
    <div class="card mb-3 my-4">
        <div class="card-body">
            <h2>Create a Chat</h2>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                    <div id="participants_field">
                        {{ form.participants }}
                    </div>
                <h3>Message</h3>
                    {{ message_formset.management_form }}
                    {% for form in message_formset %}
                        {{ form.as_p }}
                    {% endfor %}
                <button type="submit">Send Message</button>
            </form>
            <a href="{% url 'chat_list' %}">Back to chats</a>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#id_participants').select2({
            ajax: {
                url: "{% url 'user_suggestions' %}",
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        q: params.term, // search term
                    };
                },
                processResults: function (data) {
                    return {
                        results: data.results
                    };
                },
                cache: true
            },
            minimumInputLength: 1,
        });
    });
</script>

{% endblock %}
